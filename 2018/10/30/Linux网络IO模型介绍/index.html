<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="宝全哥哥">
    
    
    
    
    
    
    <title>Linux网络I/O模型介绍(一) | DonY15</title>
    <link href=”http://yoursite.com“ rel=”prefetch” />

    <link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/aos.css">
<link rel="stylesheet" href="/css/style.css">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/aos.js"></script>
    <script src="/js/highslide/highslide-full.min.js"></script>
    <link rel="stylesheet" href="/js/highslide/highslide.css">
    <style type="text/css">
        @media (max-width: 768px) {
            body {
                background-color: #f0f0f0;
                background: url('/imgs/xsbg.gif');
                background-attachment: fixed;
            }
        }
    </style>
    
    <script src="//cdn1.lncld.net/static/js/3.4.2/av-min.js"></script>
    <script>
      AV.init({
        appId: 'Sd0rIgx60GcgbzBuEgMwUyzG-gzGzoHsz',
        appKey: 'nYP6CNjSvE1TUhTur6M4ldxz'
      })
    </script>
    
    <!--<script type="text/javascript">
      if (document.images) {
        var avatar = new Image();
        avatar.src = '/imgs/avatar.jpg'
        var previews = 'preview1.jpg,preview2.jpg,preview3.jpg,preview4.jpg,preview5.jpg,preview6.jpg,preview7.jpg,preview8.jpg,preview9.jpg,preview10.jpg,preview11.jpg,preview12.jpg,preview13.jpg,preview14.jpg'.split(',')
        var previewsPreLoad = []
        for(var i = 0; i < length; i++) {
          previewsPreLoad.push(new Image())
          previewsPreLoad[previewsPreLoad.length - 1].src = '/imgs/preview' + previews[i]
        }
      }
    </script>-->
		<!--统计-->
			<!--<script src="https://cdn1.lncld.net/static/js/av-min-1.2.1.js"></script>-->
		<!--<script>AV.initialize("Sd0rIgx60GcgbzBuEgMwUyzG-gzGzoHsz", "nYP6CNjSvE1TUhTur6M4ldxz");</script>-->
		<script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.7.3/dist/av-min.js"></script>
		<script src="//cdn.jsdelivr.net/npm/leancloud-realtime@4.1.0/dist/realtime.browser.min.js"></script>
		<script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.7.3/dist/av-live-query-min.js"></script>
		
		<script>
		// 存储服务
		var { Query, User } = AV;
		AV.init('Sd0rIgx60GcgbzBuEgMwUyzG-gzGzoHsz', 'nYP6CNjSvE1TUhTur6M4ldxz');
		// 实时消息服务
		var { Realtime, TextMessage } = AV;
		
		</script>
		
</head>
<body>
    <!-- 背景轮播图功能 -->
    <section class="hidden-xs">
    <ul class="cb-slideshow">
        <li><span>天若</span></li>
        <li><span>有情</span></li>
        <li><span>天亦老</span></li>
        <li><span>我为</span></li>
        <li><span>长者</span></li>
        <li><span>续一秒</span></li>
    </ul>
</section>
    <!-- 欧尼酱功能, 谁用谁知道 -->
    
    <div class="gal-menu gal-dropdown">
    <div class="circle" id="gal">
        <div class="ring">
            <a href="http://yoursite.com" class="menuItem" style="left: 50%; top: 15%;">首页</a>
            
            <a class="menuItem" style="left: 80.3109%; top: 32.5%;">下一页</a>
            
            <a href="/archives" class="menuItem" style="left: 80.3109%; top: 67.5%;">归档</a>
            <a href="/categories" class="menuItem" style="left: 50%; top: 85%;">目录</a>
            <a href="/message" class="menuItem" style="left: 19.6891%; top: 67.5%;">留言板</a>
            
            <a class="menuItem" style="left: 19.6891%; top: 32.5%;">上一页</a>
            
        </div>
        <audio id="audio" src="/imgs/oni.mp3"></audio>
    </div>
</div>
    
    <header class="navbar navbar-inverse" id="gal-header">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target=".bs-navbar-collapse"
                    aria-expanded="false">
                <span class="fa fa-lg fa-reorder"></span>
            </button>
            <!--<a href="http://yoursite.com">-->
						<a href="/">
                
                <style>
                    #gal-header .navbar-brand {
                        height: 54px;
                        line-height: 24px;
                        font-size: 28px;
                        opacity: 1;
                        background-color: rgba(0,0,0,0);
                        text-shadow: 0 0 5px #fff,0 0 10px #fff,0 0 15px #fff,0 0 20px #228DFF,0 0 35px #228DFF,0 0 40px #228DFF,0 0 50px #228DFF,0 0 75px #228DFF;
                    }
                </style>
                <!-- 这里使用文字(navbar_text or config.title) -->
                <div class="navbar-brand">DonY15</div>
                
            </a>
        </div>
        <div class="collapse navbar-collapse bs-navbar-collapse">
            <ul class="nav navbar-nav" id="menu-gal">
                
                
                <li class="">
                    <a href="/">
                        <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                
                
                <li class="">
                    <a href="/archives">
                        <i class="fa fa-archive"></i>归档
                    </a>
                </li>
                
                
                
                
                <li class="dropdown">
                    <!-- TODO 添加hover dropdown效果 -->
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false" data-hover="dropdown">
                        <i class="fa fa-list"></i>目录
                    </a>
                    <ul class="dropdown-menu">
                        
                        
                        <li>
                            <a href="/categories/Web基础/">Web基础</a>
                        </li>
                        
                        <li>
                            <a href="/categories/框架/">框架</a>
                        </li>
                        
                        <li>
                            <a href="/categories/JAVA并发编程/">JAVA并发编程</a>
                        </li>
                        
                        <li>
                            <a href="/categories/软件/">软件</a>
                        </li>
                        
                        <li>
                            <a href="/categories/组件/">组件</a>
                        </li>
                        
                        <li>
                            <a href="/categories/搭建/">搭建</a>
                        </li>
                        
                        <li>
                            <a href="/categories/IDE/">IDE</a>
                        </li>
                        
                        <li>
                            <a href="/categories/I-O/">I/O</a>
                        </li>
                        
                        <li>
                            <a href="/categories/Linux基础/">Linux基础</a>
                        </li>
                        
                        <li>
                            <a href="/categories/Spring全家桶/">Spring全家桶</a>
                        </li>
                        
                        <li>
                            <a href="/categories/SE基础/">SE基础</a>
                        </li>
                        
                        <li>
                            <a href="/categories/初等数学/">初等数学</a>
                        </li>
                        
                        <li>
                            <a href="/categories/工具类/">工具类</a>
                        </li>
                        
                        <li>
                            <a href="/categories/微服务/">微服务</a>
                        </li>
                        
                        <li>
                            <a href="/categories/服务器/">服务器</a>
                        </li>
                        
                        <li>
                            <a href="/categories/网络编程/">网络编程</a>
                        </li>
                        
                        <li>
                            <a href="/categories/SQL/">SQL</a>
                        </li>
                        
                        
                        
                    </ul>
                </li>
                
                
                
                
                
                <li class="">
                    <a href="/tags">
                        <i class="fa fa-tags"></i>标签
                    </a>
                </li>
                
                
                
                
                <li class="">
                    <a href="/message">
                        <i class="fa fa-user"></i>留言板
                    </a>
                </li>
                
                
            </ul>
        </div>
    </div>
</header>
    <div id="gal-body">
        <div class="container">
            <div class="row">
                <div class="col-md-8 gal-right" id="mainstay">
                    
<article class="article well article-body" id="article">
    <div class="breadcrumb">
        <i class="fa fa-home"></i>
       
				<a href="/">DonY15</a>
        >
        <span>Linux网络I/O模型介绍(一)</span>
    </div>
    <!-- 大型设备详细文章 -->
    <div class="hidden-xs">
        <div class="title-article">
            <h1>
                <a href="/2018/10/30/Linux网络IO模型介绍/">Linux网络I/O模型介绍(一)</a>
            </h1>
        </div>
        <div class="tag-article">
            
            <span class="label label-gal">
                <i class="fa fa-calendar"></i> 2018-10-30
            </span>
            
            <span class="label label-gal">
                <i class="fa fa-eye"></i>
            </span>
            
        </div>
    </div>
    <!-- 小型设备详细文章 -->
    <div class="visible-xs">
        <center>
            <div class="title-article">
                <h4>
                    <a href="/2018/10/30/Linux网络IO模型介绍/">Linux网络I/O模型介绍(一)</a>
                </h4>
            </div>
            <p>
                <i class="fa fa-calendar"></i> 2018-10-30
            </p>
            <p>
                
                
                <i class="fa fa-eye"></i>
                
            </p>
        </center>
    </div>
    <div class="content-article">
        <h1 id="Linux网络I-O模型介绍-一"><a href="#Linux网络I-O模型介绍-一" class="headerlink" title="Linux网络I/O模型介绍(一)"></a>Linux网络I/O模型介绍(一)</h1><p>[TOC]</p>
<h3 id="1-概念"><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h3><p>Linux的<strong>内核</strong>将所有外部设备都看作一个文件来操作,对一个文件的读写操作会调用内核提供的系统指令,返回一个file desc(<strong>fd 文件描述符</strong>)</p>
<p>对一个<strong>socket的读写也会有相应的描述符</strong>(指向内核中的一个结构体:文件路径/数据区等信息)</p>
<p>即:<strong>内核空间和磁盘控制器</strong>的组合概念</p>
<h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><h3 id="2-五种I-O模型"><a href="#2-五种I-O模型" class="headerlink" title="2.五种I/O模型"></a>2.五种I/O模型</h3><ol>
<li>阻塞I/O模型</li>
<li>非阻塞I/O模型</li>
<li>I/O复用模型</li>
<li>信号驱动I/O模型</li>
<li>异步I/O模型</li>
</ol>
<h4 id="1-阻塞I-O模型"><a href="#1-阻塞I-O模型" class="headerlink" title="1.阻塞I/O模型:"></a>1.阻塞I/O模型:</h4><p>最常见的I/O模型,缺省情况下,所有文件的操作都是阻塞的,一条线完成</p>
<h4 id="2-非阻塞I-O模型"><a href="#2-非阻塞I-O模型" class="headerlink" title="2.非阻塞I/O模型"></a>2.非阻塞I/O模型</h4><p>如java1.4更新的NIO,增加缓冲区:</p>
<p>recvfrom从<strong>应用层</strong>到<strong>内核</strong>时,如果该缓冲区没有数据的话,则直接返回一个<strong>EWOULDBLOCK错误状态</strong>,</p>
<p>一般非阻塞<strong>使用轮询检查这个状态</strong>,来判断内核是否有数据</p>
<h4 id="3-I-O复用模型"><a href="#3-I-O复用模型" class="headerlink" title="3.I/O复用模型"></a>3.I/O复用模型</h4><p>Linux提供select/poll,进程将通过一个或多个fd传递给select或poll系统调用,<strong>阻塞在select操作上,</strong>这样就可以检测多个fd的准备状态</p>
<p>select/poll的缺点是顺序扫描fd状态,而且数量有限</p>
<p>因此Linux提供了<strong>epoll</strong>系统调用改进,使用<strong>驱动事件方式</strong>代替顺序扫描,当有fd准备好后,立刻返回rollback,性能更强大,Netty借鉴部分</p>
<h4 id="4-信号驱动I-O模型"><a href="#4-信号驱动I-O模型" class="headerlink" title="4.信号驱动I/O模型"></a>4.信号驱动I/O模型</h4><p>首先开启套接口信号驱动I/O功能,通过系统调用sigaction执行一个信号处理函数然后返回.(<strong>非阻塞</strong>)</p>
<p>当数据准备好后会出发该函数生成SIGIO信号,通过信号通知应用程序调用recvfrom来读取数据,并通知主循环函数处理数据</p>
<p>该模型告诉应用程序什么时候可以开始I/O操作</p>
<h4 id="5-异步IO模型"><a href="#5-异步IO模型" class="headerlink" title="5.异步IO模型"></a>5.异步IO模型</h4><p>告知内核启动某个操作,并让内核在整个操作完成后通知应用程序</p>
<p>告诉应用什么时候I/O操作完成</p>
<h3 id="3-I-O多路复用技术"><a href="#3-I-O多路复用技术" class="headerlink" title="3.I/O多路复用技术"></a>3.I/O多路复用技术</h3><p><strong>特点:</strong></p>
<p>多路复用最大的优势是系统开销小,不需要创建新的额外进程活鲜城,也不需要维护这些线程.节约资源</p>
<p><strong>场景:</strong></p>
<p>服务器需要同时处理多个处于监听状态或者多个连接状态的套接字</p>
<p>服务器需要同时处理多种协议的套接字</p>
<p>支持I/O多路复用技术的系统调用包括:select/pselect/poll/epoll</p>
<p><strong>目前epoll替代select,原因如下:</strong></p>
<ol>
<li>支持一个进程打开socket描述符(fd)的数量不受限制(仅受操作系统最大文件句柄数影响)</li>
<li>I/O效率不会随着FD数目的增加而线性下降(事件驱动机制)</li>
<li>使用mmap加速内核与用户空间的消息传递(epoll是通过内核和用户空间mmap同一块内存实现)</li>
<li>epoll的API更加简单</li>
</ol>
<h3 id="4-BIO-Socket示例"><a href="#4-BIO-Socket示例" class="headerlink" title="4.BIO Socket示例"></a>4.BIO Socket示例</h3><p><strong>服务器端</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @ClassMame: bio_socket_server</span><br><span class="line"> * @Description: TODO</span><br><span class="line"> * @Author 宝全</span><br><span class="line"> * @Date 2018/10/26 17:16</span><br><span class="line"> * @Version 1.0</span><br><span class="line"> */</span><br><span class="line">public class DemoSocketServer &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        Integer port = 8080;</span><br><span class="line">        ServerSocket serverSocket = new ServerSocket(port);</span><br><span class="line">        System.out.println(&quot;服务启动成功!&quot;);</span><br><span class="line">        while (true)&#123;</span><br><span class="line">            System.out.println(Arrays.toString(args));</span><br><span class="line">            Socket socket = serverSocket.accept();</span><br><span class="line">            System.out.println(&quot;接入一个Socket客户端&quot;);</span><br><span class="line">            new Thread(new DemoSocketClientListening(socket)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DemoSocketClientListening implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">    private Socket socket;</span><br><span class="line"></span><br><span class="line">    public DemoSocketClientListening(Socket socket) &#123;</span><br><span class="line">        this.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        BufferedReader br = null;</span><br><span class="line">        PrintWriter printWriter = null;</span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            br = new BufferedReader(new InputStreamReader(this.socket.getInputStream()));</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                String s = br.readLine();</span><br><span class="line">                if (s == null) return;</span><br><span class="line">                System.out.println(s);</span><br><span class="line">                printWriter = new PrintWriter(this.socket.getOutputStream(), true);</span><br><span class="line">                printWriter.println(&quot;发送成功!&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                if (br != null) &#123;</span><br><span class="line">                    br.close();</span><br><span class="line">                &#125;</span><br><span class="line">                if (printWriter != null) &#123;</span><br><span class="line">                    printWriter.close();</span><br><span class="line">                &#125;</span><br><span class="line">                if (socket != null) &#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>客户端</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @ClassMame: DemoSocketClient</span><br><span class="line"> * @Description: TODO</span><br><span class="line"> * @Author 宝全</span><br><span class="line"> * @Date 2018/10/26 17:28</span><br><span class="line"> * @Version 1.0</span><br><span class="line"> */</span><br><span class="line">public class DemoSocketClient &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Socket socket = null;</span><br><span class="line">        BufferedReader br = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            socket = new Socket(&quot;localhost&quot;, 8080);</span><br><span class="line"></span><br><span class="line">            System.out.println(&quot;客户端连接成功&quot;);</span><br><span class="line">            Scanner scanner = new Scanner(System.in);</span><br><span class="line">            br = new BufferedReader(new InputStreamReader(socket.getInputStream()));</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                System.out.println(&quot;输入信息:↓\n\r&quot;);</span><br><span class="line">                String msg = scanner.nextLine();</span><br><span class="line">                PrintStream ps = new PrintStream(socket.getOutputStream(), true);</span><br><span class="line">                System.out.println(&quot;发送中...&quot;);</span><br><span class="line">                ps.println(msg);</span><br><span class="line">                if (socket.getInputStream().available() == 0) &#123;</span><br><span class="line">                    System.out.println(br.readLine());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                if (br != null) &#123;</span><br><span class="line">                    br.close();</span><br><span class="line">                &#125;</span><br><span class="line">                if (socket!=null)&#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>同步Socket服务器产生的问题是阻塞,和线程的创建</strong></p>
<p>每一个接入的客户端都需要创建一个新的线程维护</p>
<p>伪异步I/O</p>
<p>使用一个Task封装socket,通过两个线程池来维护线程</p>
<p>伪异步IO只是对同步IO的简单优化,本质还是同步I/O,并不能解决问题</p>
<ol>
<li>服务器处理缓慢,返回应答消息消耗60s(平时只需要10ms)</li>
<li>采用伪异步I/O的线程正在读取故障节点的响应,由于读取输入流是阻塞的,将会被同步阻塞60s</li>
<li>当所有可用线程都被故障服务器阻塞,那么后续的大量I/O都在排排队</li>
<li>由于采用阻塞队列线程池,当队列集满后,后续入队的操作也会被阻塞</li>
<li>由于前段只有一个Accptor线程接收客户端接入,它被阻塞在线程池的同步阻塞队列之后,新的客户端请求将被拒绝,客户端发生大量连接超时</li>
<li>由于几乎所有连接都超时,调用者认为该系统已经崩溃,无法接收新的请求</li>
</ol>
<p>BIO<strong>搭建服务器模型/模拟浏览器请求</strong>实例</p>
<p><strong><a href="https://blog.csdn.net/sunxing007/article/details/4305956" target="_blank" rel="noopener">https://blog.csdn.net/sunxing007/article/details/4305956</a></strong> </p>
<h3 id="5-NIO多路复用器-反应堆模式-select模式"><a href="#5-NIO多路复用器-反应堆模式-select模式" class="headerlink" title="5.NIO多路复用器(反应堆模式)select模式"></a><strong>5.NIO多路复用器(反应堆模式)select模式</strong></h3><p><img src="https://i.imgur.com/3PYv2KS.png" alt=""></p>
<h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @ClassMame: DemoServerSocket</span><br><span class="line"> * @Description: TODO</span><br><span class="line"> * @Author 宝全</span><br><span class="line"> * @Date 2018/10/29 16:20</span><br><span class="line"> * @Version 1.0</span><br><span class="line"> */</span><br><span class="line">public class DemoTimeServer &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Integer port = 8000;</span><br><span class="line">        MultiplexerTimeServer timeServer = new MultiplexerTimeServer(port);</span><br><span class="line">        new Thread(timeServer, &quot;NIO-MultiplexerTimeServer-001&quot;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * IO多路复用器</span><br><span class="line"> */</span><br><span class="line">class MultiplexerTimeServer implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">    private Selector selector; //选择器(多路复用器)</span><br><span class="line">    private ServerSocketChannel serverChannel; //可选择通道</span><br><span class="line">    private volatile boolean stop;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过构造初始化资源</span><br><span class="line">     * @param port</span><br><span class="line">     */</span><br><span class="line">    public MultiplexerTimeServer(Integer port) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            selector = Selector.open();</span><br><span class="line">            serverChannel = ServerSocketChannel.open();</span><br><span class="line">            serverChannel.configureBlocking(false);</span><br><span class="line">            serverChannel.socket().bind(new InetSocketAddress(port), 1024);</span><br><span class="line">            serverChannel.register(selector, SelectionKey.OP_ACCEPT); //注册连接监听操作</span><br><span class="line">            System.out.println(&quot;时间服务器在&quot; + port + &quot;端口启动&quot;);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.exit(1); //如果初始化失败(如端口冲突),则退出程序</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void stop() &#123;</span><br><span class="line">        this.stop = true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        while (!stop) &#123; //自旋循环</span><br><span class="line">            try &#123;</span><br><span class="line">                selector.select(1000);//多路复用器每隔1秒激活一次准备</span><br><span class="line">                Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); //查看所有selectionKey</span><br><span class="line">                Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator();</span><br><span class="line">                SelectionKey key = null;</span><br><span class="line">                while (iterator.hasNext()) &#123;</span><br><span class="line">                    key = iterator.next();//如果多路复用器中有注册,那么赋值给SelectionKey,并移除原有的key</span><br><span class="line">                    iterator.remove();</span><br><span class="line">                    try &#123;</span><br><span class="line">                        handleInput(key); //将Key传到IO事件中使用(包含通道信息)</span><br><span class="line">                    &#125; catch (Exception e) &#123;</span><br><span class="line">//                        e.printStackTrace();</span><br><span class="line">                        System.out.println(&quot;一个连接断开&quot;);</span><br><span class="line">                        if (key != null) &#123;</span><br><span class="line">                            key.channel();</span><br><span class="line">                        &#125;</span><br><span class="line">                        if (key.channel() != null) &#123;</span><br><span class="line">                            key.channel().close();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //多路复用器关闭以后,所有上面注册的通道都会关闭,不需要重复释放</span><br><span class="line">        if (selector!=null)&#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                selector.close();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * IO事件处理器</span><br><span class="line">     * @param key</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    private void handleInput(SelectionKey key) throws IOException &#123;</span><br><span class="line">        if (key.isValid()) &#123; //判断该键是否有效</span><br><span class="line"></span><br><span class="line">            //判断连接权限,如果连接成功,则将该Socket作为服务监听Socket,给该链接附加读操作权限</span><br><span class="line">            if (key.isAcceptable()) &#123;</span><br><span class="line">                ServerSocketChannel ssc = (ServerSocketChannel) key.channel();</span><br><span class="line">                SocketChannel socketChannel = ssc.accept();</span><br><span class="line">                socketChannel.configureBlocking(false);;</span><br><span class="line">                socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">            &#125;</span><br><span class="line">            //---------------------上面两个判断相当于完成了TCP的三次握手,TCP物理链路层正式建立(可以对该链接的配置做更为细致的设置)</span><br><span class="line"></span><br><span class="line">            //判断读权限,如果该链接具有读权限,则将该Socket作为客户端Socket,并进行读操作</span><br><span class="line">            if (key.isReadable()) &#123;</span><br><span class="line">                SocketChannel socketChannel = (SocketChannel) key.channel();</span><br><span class="line">                ByteBuffer byteBuffer = ByteBuffer.allocate(1024);</span><br><span class="line">                int read = socketChannel.read(byteBuffer);</span><br><span class="line"></span><br><span class="line">                //因为socketChannel的read已经是非阻塞线程,所以使用返回值判断即可</span><br><span class="line">                if (read &gt; 0) &#123;</span><br><span class="line">                    //翻转</span><br><span class="line">                    byteBuffer.flip();</span><br><span class="line">                    byte[] bytes = new byte[byteBuffer.remaining()];</span><br><span class="line">                    byteBuffer.get(bytes);</span><br><span class="line">                    String body = new String(bytes, &quot;UTF-8&quot;);</span><br><span class="line">                    System.out.println(&quot;时间服务器接收到信息:&quot; + body);</span><br><span class="line"></span><br><span class="line">                    String currentTime = &quot;QUERY TIME ORDER&quot;.equalsIgnoreCase(body) ? new Date(System.currentTimeMillis()).toString() : &quot;BAD ORDER&quot;;</span><br><span class="line">                    doWrite(socketChannel, currentTime);</span><br><span class="line">                &#125; else if (read &lt; 0) &#123;</span><br><span class="line">                    //断开初测关系,并关闭通道</span><br><span class="line">                    key.cancel();</span><br><span class="line">                    socketChannel.close();</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    ; //读取为0时不处理</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 写操作(可以使用hasRemaining()(检测缓冲区是否写干净)来做&apos;写半包&apos;判定(此处没有做,但是会发生该情况))</span><br><span class="line">     * @param channel</span><br><span class="line">     * @param response</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    private void doWrite(SocketChannel channel, String response) throws IOException &#123;</span><br><span class="line">        if (response != null &amp;&amp; response.trim().length() &gt; 0) &#123;</span><br><span class="line">            byte[] bytes = response.getBytes();</span><br><span class="line">            ByteBuffer byteBuffer = ByteBuffer.allocate(bytes.length);</span><br><span class="line">            byteBuffer.put(bytes);</span><br><span class="line"></span><br><span class="line">            byteBuffer.flip();</span><br><span class="line">            channel.write(byteBuffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/w6p9wGP.png" alt=""></p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">    public void doConnect() throws IOException &#123;</span><br><span class="line">        socketChannel.connect(new InetSocketAddress(address, port));</span><br><span class="line">        if (socketChannel.isConnected()) &#123;</span><br><span class="line">            socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">            doWrite(socketChannel);</span><br><span class="line">        &#125; else if (socketChannel.isConnectionPending())&#123;</span><br><span class="line">            if (socketChannel.finishConnect())&#123;</span><br><span class="line">                socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                doWrite(socketChannel);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            socketChannel.register(selector, SelectionKey.OP_CONNECT);</span><br><span class="line">        &#125;</span><br><span class="line">        socketChannel.configureBlocking(false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void handleSocket(SelectionKey key) throws IOException &#123;</span><br><span class="line">        if (key.isValid()) &#123;</span><br><span class="line">            SocketChannel sc = (SocketChannel) key.channel();</span><br><span class="line">            if (key.isConnectable()) &#123;</span><br><span class="line">                if (sc.finishConnect()) &#123;</span><br><span class="line">                    sc.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                    System.out.println(key.isReadable());  //??不可读 false</span><br><span class="line">                    System.out.println(key.isConnectable()); //已连接 true</span><br><span class="line">                    System.out.println(sc.isRegistered()); //已注册 true</span><br><span class="line">                    doWrite(sc);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    System.exit(1); //链接失败</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(key.isReadable());</span><br><span class="line">            if (key.isReadable()) &#123;</span><br><span class="line">                ByteBuffer byteBuffer = ByteBuffer.allocate(1024);</span><br><span class="line">                int read = socketChannel.read(byteBuffer);</span><br><span class="line"></span><br><span class="line">                if (read &gt; 0) &#123;</span><br><span class="line">                    byteBuffer.flip();</span><br><span class="line">                    byte[] bytes = new byte[byteBuffer.remaining()];</span><br><span class="line">                    byteBuffer.get(bytes);</span><br><span class="line"></span><br><span class="line">                    String body = new String(bytes, &quot;UTF-8&quot;);</span><br><span class="line">                    System.out.println(&quot;客户端接收消息:&quot; + body);</span><br><span class="line">                    stop();</span><br><span class="line">                &#125; else if (read &lt; 0) &#123;</span><br><span class="line">                    key.cancel();</span><br><span class="line">                    socketChannel.close();</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    ;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void doWrite(SocketChannel socketChannel) &#123;</span><br><span class="line">        byte[] bytes = &quot;QUERY TIME ORDER&quot;.getBytes();</span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(bytes.length);</span><br><span class="line">        byteBuffer.put(bytes);</span><br><span class="line">        byteBuffer.flip();</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            socketChannel.write(byteBuffer);</span><br><span class="line">            if (!byteBuffer.hasRemaining()) &#123; //半包写检测(非处理方案)</span><br><span class="line">                System.out.println(&quot;Send order 2 server succeed&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-AIO"><a href="#6-AIO" class="headerlink" title="6.AIO"></a><strong>6.AIO</strong></h3><p><strong>NIO2.0的异步IO,是真正的异步非阻塞IO,</strong></p>
<p>对应Unix中的<strong>事件驱动I/O(AIO)</strong></p>
<p>不需要通过多路复用器对注册通道进行了轮询即可实现异步读写</p>
<p>从而<strong>简化了NIO的编程模型</strong></p>
<p>因为是事件驱动的被动模式,因此通过被动回调(JDK底层通过线程池ThreadPoolExecutor执行)即可,不需要单独的创建线程</p>

    </div>
</article>


<div id="comments-template"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script>
	if(!window.commentConfig) {
      window.commentConfig = {}
      window.commentConfig.title = 'Linux网络I/O模型介绍(一)'
    }
</script>

                </div>
                <aside class="col-md-4 gal-left" id="sidebar">
    <!-- 此为sidebar的搜索框, 非搜索结果页面 -->
<aside id="sidebar-search">
    <div class="search hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <form class="form-inline clearfix" id="search-form" method="get"
              action="/search/index.html">
            <input type="text" name="s" class="form-control" id="searchInput" placeholder="搜索文章~">
            <button class="btn btn-danger btn-gal" type="submit">
                <i class="fa fa-search"></i>
            </button>
        </form>
    </div>
</aside>
    <aside id="sidebar-author">
    <div class="panel panel-gal" data-aos="flip-right" data-aos-duration="3000">
        <div class="panel-heading" style="text-align: center">
            <i class="fa fa-quote-left"></i>
            宝全哥哥
            <i class="fa fa-quote-right"></i>
        </div>
        <div class="author-panel text-center">
            <img src="/imgs/avatar.jpg" width="140" height="140"
                 alt="个人头像" class="author-image">
            <p class="author-description"></p>
        </div>
    </div>
</aside>
    
    <aside id="sidebar-recent_comments">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-comments"></i>
            最新评论
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush"></ul>
    </div>
</aside>
    
    <!-- 要配置好leancloud才能开启此小工具 -->
    
    <aside id="sidebar-hot_posts">
    <div class="panel panel-gal hot hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-fire"></i>
            最热文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush"></ul>
    </div>
</aside>
    
    
    <aside id="sidebar-recent_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            近期文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/12/09/Dony15_Search使用文档/">Dony15_Search使用文档</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/30/Linux网络IO模型介绍/">Linux网络I/O模型介绍(一)</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/24/NIO基础入门(四)之Channel-to-Channel传输/">NIO基础入门(四)之Channel-to-Channel传输</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/24/NIO基础入门(六)之选择器Selectors/">NIO基础入门(六)之选择器selectors</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/24/NIO基础入门(五)之Socket通道&管道/">NIO基础入门(五)之Socket通道&amp;管道</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/23/NIO基础入门(三)之文件锁定与内存映射文件/">NIO基础入门(三)之文件锁定与内存映射文件</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/23/NIO基础入门(二)之通道Channel/">NIO基础入门(二)之通道Channel</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/23/NIO基础入门(一)之缓冲区Buffer/">NIO基础入门(一)之缓冲区Buffer</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/19/Concurrent并发包入门(四)之Executor/">Concurrent并发包入门(四)之Executor</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/19/Concurrent并发包入门(三)之Synchronizers/">Concurrent并发包入门(三)之Synchronizers</a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="sidebar-rand_posts">
    <div class="panel panel-gal recent hidden-xs" data-aos="fade-up" data-aos-duration="2000">
        <div class="panel-heading">
            <i class="fa fa-refresh"></i>
            随机文章
            <i class="fa fa-times-circle panel-remove"></i>
            <i class="fa fa-chevron-circle-up panel-toggle"></i>
        </div>
        <ul class="list-group list-group-flush">
            
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/09/05/Docker容器基础/">Docker容器基础</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2017/12/02/FreeMarker和Nginx_FTP原理使用/">FreeMarker结合Nginx|FTP基础使用</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/24/NIO基础入门(五)之Socket通道&管道/">NIO基础入门(五)之Socket通道&amp;管道</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2017/04/17/jQuery基础(实用部分)整理/">jQuery基础(实用部分)整理</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2017/07/05/java基础SE-java优点/">javaSE-java优点</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/07/08/工具类集合分析--接口/">工具类集合分析--接口</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/09/10/微服务入门/">微服务入门</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/04/15/Spring基础原理/">Spring基础原理</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2018/10/01/WebSocket入门/">WebSocket入门</a>
                </span>
            </li>
            
            <li class="list-group-item">
                <span class="post-title">
                    <a href="/2017/06/02/java-IO/">java-IO</a>
                </span>
            </li>
            
        </ul>
    </div>
</aside>
    
    
    <aside id="gal-sets">
        <div class="panel panel-gal hidden-xs" data-aos="fade-up" data-aos-duration="2000">
            <ul class="nav nav-pills pills-gal">
                <li class="">
                    <a href="/2018/10/30/Linux网络IO模型介绍/index.html#sidebar-tags" data-toggle="tab" id="tags-tab">热门标签</a>
                </li>
                <li class="">
                    <a href="/2018/10/30/Linux网络IO模型介绍/index.html#sidebar-friend-links" data-toggle="tab" id="friend-links-tab">友情链接</a>
                </li>
                <li class="">
                    <a href="/2018/10/30/Linux网络IO模型介绍/index.html#sidebar-links" data-toggle="tab" id="links-tab">个人链接</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="cloud-tags tab-pane nav bs-sidenav fade" id="sidebar-tags">
    
</div>
                <div class="friend-links tab-pane nav bs-sidenav fade" id="sidebar-friend-links">
    
    <li>
        <a href="http://kdays.net/days/" target="_blank">KDays Forum</a>
    </li>
    
    <li>
        <a href="http://www.gal123.com/" target="_blank">绅士导航♂</a>
    </li>
    
    <li>
        <a href="http://www.moe123.com/" target="_blank">萌导航</a>
    </li>
    
</div>
                <div class="links tab-pane nav bs-sidenav fade" id="sidebar-links">
    
    <li>
        <a href="https://github.com/dony15" target="_blank">Github</a>
    </li>
    
</div>
            </div>
        </div>
    </aside>
    
</aside>
            </div>
        </div>
    </div>
    <footer id="gal-footer">
    <div class="container">
        Copyright © 2018 宝全哥哥 Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/ZEROKISEKI" target="_blank">AONOSORA</a>
    </div>
</footer>

<!-- 回到顶端 -->
<div id="gal-gotop">
    <i class="fa fa-angle-up"></i>
</div>

<!--page counter part统计-->
<script>
function addCount (Counter) {
        url=$('.article-date').attr('href').trim();
        title = $('.article-title').text().trim();
        var query=new AV.Query(Counter);
        //use url as unique idnetfication
        query.equalTo("url",url);
        query.find({
            success: function(results){
                if(results.length>0)
                {
                    var counter=results[0];
                    counter.fetchWhenSave(true); //get recent result
                    counter.increment("time");
                    counter.save();
                }
                else
                {
                    var newcounter=new Counter();
                    newcounter.set("title",title);
                    newcounter.set("url",url);
                    newcounter.set("time",1);
                    newcounter.save(null,{
                        success: function(newcounter){
                        //alert('New object created');
                        },
                        error: function(newcounter,error){
                        alert('Failed to create');
                        }
                        });
                }
            },
            error: function(error){
                //find null is not a error
                alert('Error:'+error.code+" "+error.message);
            }
        });
}
$(function(){
        var Counter=AV.Object.extend("Counter");
        //only increse visit counting when intering a page
        if ($('.article-title').length == 1)
           addCount(Counter);
        var query=new AV.Query(Counter);
        query.descending("time");
        // the sum of popular posts
        query.limit(10); 
        query.find({
            success: function(results){
                    for(var i=0;i<results.length;i++)    
                    {
                        var counter=results[i];
                        title=counter.get("title");
                        url=counter.get("url");
                        time=counter.get("time");
                        // add to the popularlist widget
                        showcontent=title+" ("+time+")";
                        //notice the "" in href
                        $('.popularlist').append('<li><a href="'+url+'">'+showcontent+'</a></li>');
                    }
                },
            error: function(error){
                alert("Error:"+error.code+" "+error.message);
            }
            }
        )
        });
</script>
</body>
<script src="/js/activate-power-mode.js"></script>
<script>

    // 配置highslide
	hs.graphicsDir = '/js/highslide/graphics/'
    hs.outlineType = "rounded-white";
    hs.dimmingOpacity = 0.8;
    hs.outlineWhileAnimating = true;
    hs.showCredits = false;
    hs.captionEval = "this.thumb.alt";
    hs.numberPosition = "caption";
    hs.align = "center";
    hs.transitions = ["expand", "crossfade"];
    hs.lang.number = '共%2张图, 当前是第%1张';
    hs.addSlideshow({
      interval: 5000,
      repeat: true,
      useControls: true,
      fixedControls: "fit",
      overlayOptions: {
        opacity: 0.75,
        position: "bottom center",
        hideOnMouseOut: true
      }
    })

    // 初始化aos
    AOS.init({
      duration: 1000,
      delay: 0,
      easing: 'ease-out-back'
    });

</script>
<script>
	POWERMODE.colorful = 'true';    // make power mode colorful
	POWERMODE.shake = 'true';       // turn off shake
	// TODO 这里根据具体情况修改
	document.body.addEventListener('input', POWERMODE);
</script>
<script>
    window.slideConfig = {
      prefix: '/imgs/slide/background',
      ext: 'jpg',
      maxCount: '8'
    }
</script>
<script src="/js/hs.js"></script>
<script src="/js/blog.js"></script>

<script src="/js/oni.js"></script>


<script>
    window.hot_posts_count = '10'
    // window.use_leancloud = 'true'
</script>
<script src="/js/comment/leancloud.js"></script>


<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    if(window.commentConfig) {
      window.commentConfig.id = 'Tue Oct 30 2018 00:00:00 GMT+0800'
      window.commentConfig.owner = 'dony15'
      window.commentConfig.repo = 'reply.github.io'
      window.commentConfig.client_id = '3e620f638731b84942ed'
      window.commentConfig.client_secret = '2a6265b3e1a280bf5d9b6c9d5e1c96c1915a778e'
      window.commentConfig.redirect_uri = ''
    } else {
      window.commentConfig = {
      	id: 'Tue Oct 30 2018 00:00:00 GMT+0800',
        owner: 'dony15',
        repo: 'reply.github.io',
        client_id: '3e620f638731b84942ed',
        client_secret: '2a6265b3e1a280bf5d9b6c9d5e1c96c1915a778e',
        redirect_uri: ''
      }
    }
</script>
<script src="/js/comment/gitment.js"></script>

</html>